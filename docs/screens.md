# 📱 画面一覧（WeddingSnap MVP）

**設計方針:** スマホファースト、ログイン状態による権限制御、参考UI: weddingshare.me

---

## 🎯 画面構成の基本方針

- **ロール:** 新郎新婦（ログイン必須） / ゲスト（ログイン不要）
- **権限制御:** ギャラリー画面は同一URLで権限により機能切替
- **認証:** 新郎新婦はGoogle認証（Clerk）、ゲストは認証不要
- **ナビゲーション:** 新郎新婦のみタブバー表示、ゲストはナビゲーションなし
- **レスポンシブ:** スマホファースト、タブレット・PC対応

---

## 📋 画面一覧（全6画面 + 認証）

### **【メイン画面】**

#### 1. ホーム画面 ⭐
- **URL:** `/home`
- **対象:** 新郎新婦のみ（認証必須）
- **機能:**

  **■ 統計情報表示**
  - アップロード済み枚数（例: 3 photos, 0 movies, 0 minutes）
  - 容量使用状況（例: 💾 0.5GB / 2GB）
  - 残り日数カウントダウン（例: ⏰ あと23日）
  - 結婚式情報（例: Nov 12 - Yuto & Mei）

  **■ 共有機能**
  - 共有URL表示 + コピーボタン（モーダル表示）
  - QRコード表示 + ダウンロードボタン（モーダル表示）
  - 招待文ボタン（将来実装）
  - 「招待リンクやQRコードは、アップグレードや設定の変更後も変わりません」注記

  **■ 一括ダウンロード**
  - [ZIP生成してメールで受け取る] ボタン
  - 生成中の場合: ステータス表示「⏳ ZIP生成中... 完了したらメールでお知らせします」（将来実装）

  **■ プランアップグレード促進**
  - 現在のプラン表示（無料 or 有料）
  - 無料プランの場合:
    - 「あとはアップグレードだけ」メッセージ
    - 「いつアップグレードしても"挙式日"から30日後まで使用可能」説明
    - [アップグレード] ボタン → 設定画面へ
  - 有料プランの場合:
    - プラン情報の表示のみ

- **UI構成（スマホファースト）**
  ```
  ┌─────────────────────────────┐
  │ 📷 WeddingSnap        ... 🚪│ ← ヘッダー
  ├─────────────────────────────┤
  │ ┌─────────────────────────┐ │
  │ │       Nov 12            │ │
  │ │     Yuto & Mei          │ │ ← 統計情報カード
  │ │                         │ │
  │ │ 💾 0.5GB/2GB ⏰あと23日 │ │
  │ │ 3 photos, 0 movies, ... │ │
  │ └─────────────────────────┘ │
  ├─────────────────────────────┤
  │ ┌─────────────────────────┐ │
  │ │ ゲストを招待しましょう！ │ │
  │ │ ゲストは何名でも参加... │ │
  │ │                         │ │
  │ │ QRコード  リンク  招待文 │ │ ← ゲスト招待カード
  │ │  [QR]    [🔗]   [💬]   │ │
  │ │                         │ │
  │ │ 招待リンクやQRコードは... │ │
  │ └─────────────────────────┘ │
  ├─────────────────────────────┤
  │ ┌─────────────────────────┐ │
  │ │ 📦 一括ダウンロード      │ │
  │ │                         │ │ ← 一括DLカード
  │ │ [ZIP生成してメールで...] │ │
  │ └─────────────────────────┘ │
  ├─────────────────────────────┤
  │ ┌─────────────────────────┐ │
  │ │⭐あとはアップグレードだけ│ │
  │ │                         │ │ ← プラン促進カード
  │ │ いつアップグレードしても  │ │   （無料時のみ）
  │ │ "挙式日"から30日後まで   │ │
  │ │ 使用可能                 │ │
  │ │                         │ │
  │ │    [アップグレード]      │ │
  │ └─────────────────────────┘ │
  └─────────────────────────────┘
  │ ┌─┐  ┌─┐  ┌─┐           │
  │ │ホ│  │ギ│  │設│           │ ← タブバー
  │ └─┘  └─┘  └─┘           │
  ```

- **画面遷移:**
  - アップグレードボタン → 設定画面（/setting）
  - QRコード/リンクボタン → モーダル表示
  - タブバー → ギャラリー（/wedding/:slug）・設定画面（/setting）

---

#### 2. ギャラリー画面 ⭐ 最重要
- **URL:** `/wedding/:slug`
- **対象:** ゲスト（全員） + 新郎新婦
- **機能:**

  **■ 全員向け機能**
  - 写真・動画一覧（サムネイルグリッド）
    - 2カラム（スマホ）、3～4カラム（タブレット・PC）
    - タップで拡大表示
    - 個別ダウンロードボタン
  - 写真・動画アップロード
    - FAB（フローティングアクションボタン）
    - ドラッグ&ドロップ対応（PC）
    - 複数ファイル同時アップロード
    - プログレスバー表示
    - アップロード完了通知

  **■ 新郎新婦向け追加表示（ログイン時のみ）**
  - ヘッダーに一括ダウンロードボタン（☁️ アイコン）
  - タブバー表示（ホーム・ギャラリー・設定）

- **UI構成（スマホファースト）**

  **ゲスト向け:**
  ```
  ┌─────────────────────────────┐
  │ 📷 WeddingSnap              │ ← ヘッダー（シンプル）
  ├─────────────────────────────┤
  │ ┌────────┐ ┌────────┐      │
  │ │ [写真] │ │ [写真] │      │ ← 2カラムグリッド
  │ └────────┘ └────────┘      │
  │ ┌────────┐ ┌────────┐      │
  │ │ [写真] │ │ [写真] │      │
  │ └────────┘ └────────┘      │
  └─────────────────────────────┘
                           [📸] ← FAB（アップロード）
  ```

  **新郎新婦向け:**
  ```
  ┌─────────────────────────────┐
  │ 📷 WeddingSnap          ☁️ │ ← ヘッダー
  │                             │   （☁️=一括DL）
  ├─────────────────────────────┤
  │ ┌────────┐ ┌────────┐      │
  │ │ [写真] │ │ [写真] │      │ ← 2カラムグリッド
  │ └────────┘ └────────┘      │
  │ ┌────────┐ ┌────────┐      │
  │ │ [写真] │ │ [写真] │      │
  │ └────────┘ └────────┘      │
  └─────────────────────────────┘
                           [📸] ← FAB（アップロード）
  │ ┌─┐  ┌─┐  ┌─┐           │
  │ │ホ│  │ギ│  │設│           │ ← タブバー
  │ └─┘  └─┘  └─┘           │
  ```

- **権限制御:**
  - フロント: `isLoggedIn` で一括DLボタン・タブバー表示
  - API: 全ての管理系操作で認証トークン検証必須
  - アップロードAPI: rate limit設定（スパム対策）

- **技術仕様:**
  - アップロード: Cloudflare Workers → R2
  - メタデータ: D1に保存（file_id, wedding_slug, uploaded_at, file_size等）
  - サムネイル: R2保存 or オンデマンド生成

- **画面遷移:**
  - FABタップ → ファイル選択 → アップロード
  - 写真タップ → 拡大表示モーダル
  - 一括DLボタン（☁️） → ホーム画面（/）へ
  - タブバー → ホーム（/）・設定画面（/setting）

---

#### 3. 設定画面
- **URL:** `/setting`
- **対象:** 新郎新婦のみ（認証必須）
- **機能:**

  **■ プラン管理**
  - 現在のプラン表示
    - 無料プラン: 容量2GB、一括DL 1回
    - 有料プラン: 容量10GB、一括DL 無制限
  - プラン変更
    - 有料プランへアップグレード（800円）
    - [支払う] ボタン → 決済処理
  - 保存期間延長
    - 延長購入（250円）
    - 現在の期限表示
    - [延長する] ボタン → 決済処理

  **■ イベント設定**
  - 結婚式名の変更
    - 入力フィールド（例: Yuto & Mei）
    - [保存] ボタン

  **■ アカウント情報**
  - メールアドレス表示
  - [ログアウト] ボタン

- **UI構成（スマホファースト）**
  ```
  ┌─────────────────────────────┐
  │ 📷 設定              ... 🚪 │ ← ヘッダー
  ├─────────────────────────────┤
  │ プラン                       │
  │ ━━━━━━━━━━━━━━━━━━━━━━━━│
  │ 現在: 無料プラン             │
  │ ・容量 2GB                   │
  │ ・一括DL 1回                 │
  │                             │
  │ [有料プランへ（800円）]      │
  │                             │
  │ 保存期間延長                 │
  │ 期限: 2025/12/15            │
  │ [延長する（250円）]          │
  ├─────────────────────────────┤
  │ イベント設定                 │
  │ ━━━━━━━━━━━━━━━━━━━━━━━━│
  │ 結婚式名                     │
  │ [Yuto & Mei        ]        │
  │                             │
  │ [保存]                       │
  ├─────────────────────────────┤
  │ アカウント                   │
  │ ━━━━━━━━━━━━━━━━━━━━━━━━│
  │ メール: yuto@example.com    │
  │                             │
  │ [ログアウト]                 │
  └─────────────────────────────┘
  │ ┌─┐  ┌─┐  ┌─┐           │
  │ │ホ│  │ギ│  │設│           │ ← タブバー
  │ └─┘  └─┘  └─┘           │
  ```

- **画面遷移:**
  - 支払いボタン → 決済処理 → 決済完了画面（/payment/success）
  - タブバー → ホーム（/）・ギャラリー（/wedding/:slug）

---

### **【認証画面】**

#### 4. 新規登録画面
- **URL:** `/signup`
- **対象:** 新規ユーザー（新郎新婦）
- **機能:**
  - Google OAuth認証ボタン
  - 利用規約・プライバシーポリシーへのリンク
  - 新規登録時に結婚式情報入力
    - 結婚式名（例: Yuto & Mei）
    - 結婚式日（日付選択）
  - システムが自動的にslugを生成（ランダム文字列）
- **画面遷移:** 登録完了 → ホーム画面（/）

---

#### 5. ログイン画面
- **URL:** `/login`
- **対象:** 既存ユーザー（新郎新婦）
- **機能:**
  - Google OAuth認証ボタン
  - 新規登録へのリンク
- **画面遷移:** ログイン成功 → ホーム画面（/）

---

### **【決済・完了画面】**

#### 6. 決済完了画面
- **URL:** `/payment/success`
- **対象:** 新郎新婦のみ
- **機能:**
  - 購入完了メッセージ
  - 購入内容表示（プラン名 or 延長、金額）
  - [ホームに戻る] ボタン
  - 領収書ダウンロード（任意）
- **画面遷移:** ホーム画面（/）へ

---

### **【エラー・情報画面】**

#### 7. 404エラー画面
- **URL:** 存在しないパス
- **対象:** 全員
- **機能:**
  - 「ページが見つかりません」メッセージ
  - トップページへ戻るリンク
  - ログインページへのリンク

---

#### 8. イベント期限切れ画面
- **URL:** `/wedding/:slug` （30日経過後）
- **対象:** 全員
- **機能:**
  - 「このイベントは終了しました」メッセージ
  - 保存期間（30日）経過の説明
  - 新規イベント作成リンク（新郎新婦向け）
- **表示条件:** D1でイベントの `expired_at` が現在日時を過ぎている場合

---

#### 9. 利用規約 / プライバシーポリシー
- **URL:** `/term`, `/privacy`
- **対象:** 全員
- **機能:**
  - テキストベースの静的ページ
  - トップページへ戻るリンク
- **法的要件:** サービス公開前に必須

---

## 🔐 権限制御マトリクス

| 画面 | ゲスト | 新郎新婦（非ログイン） | 新郎新婦（ログイン） |
|------|--------|----------------------|---------------------|
| 新規登録 | ⚪️ | ⚪️ | - |
| ログイン | - | ⚪️ | - |
| ホーム画面 | ❌ | ❌ | ⚪️ |
| ギャラリー画面 | ⚪️ (制限付き) | ⚪️ (制限付き) | ⚪️ (全機能) |
| 設定画面 | ❌ | ❌ | ⚪️ |
| 決済完了 | ❌ | ❌ | ⚪️ |
| 404エラー | ⚪️ | ⚪️ | ⚪️ |
| 期限切れ画面 | ⚪️ | ⚪️ | ⚪️ |
| 利用規約等 | ⚪️ | ⚪️ | ⚪️ |

**注記:** `isOwner` チェックは不要。ログインしているユーザーは自身のイベントのみアクセス可能。

---

## 📍 URL設計

| 画面 | URL | 備考 |
|------|-----|------|
| ホーム | `/` | 新郎新婦専用、ログイン必須 |
| ギャラリー | `/wedding/:slug` | 全員アクセス可、権限で機能切替 |
| 設定 | `/setting` | 新郎新婦専用、ログイン必須 |
| 新規登録 | `/signup` | 未ログインのみ |
| ログイン | `/login` | 未ログインのみ |
| 決済完了 | `/payment/success` | 決済後リダイレクト |
| 利用規約 | `/term` | 全員アクセス可 |
| プライバシーポリシー | `/privacy` | 全員アクセス可 |
| 404エラー | `*` | 存在しないパス |

### **Slug設計**
- **形式:** ランダム文字列（例: `a7x9k2p4`, `m3n8q1r5`）
- **長さ:** 32文字
- **文字種:** 英数字（大文字小文字区別なし、または小文字のみ）
- **生成方法:** システムが自動生成（新規登録時）
- **ユニーク性:** D1でユニークキー制約
- **安全性重視:** 推測不可能、ブルートフォース対策
- **ユーザー編集:** 不可（変更できない）

### **ナビゲーション**
- **新郎新婦ログイン時:**
  - デフォルト遷移先: ホーム画面（/）
  - タブバー: ホーム（/） - ギャラリー（/wedding/:slug） - 設定（/setting）
- **ゲスト:**
  - アクセス先: ギャラリー（/wedding/:slug）のみ
  - タブバーなし、ナビゲーションなし

---

## 🎨 デザイン指針（MVP）

### 参考UI
- **weddingshare.me** - シンプルで分かりやすいレイアウト
- カード型UI（白背景、影付き）
- 大きめのタップ領域
- 絵文字・アイコンで直感的に

### カラーパレット
- **プライマリ:** 結婚式らしい上品な色（例: ゴールド、ローズゴールド、パステルブルー）
- **アクセント:** CTA用の目立つ色（例: コーラルピンク、エメラルドグリーン）
- **背景:** 白 or ライトグレー（写真が引き立つ）

### コンポーネント
- **ボタン:** 大きめ（タップしやすい）、角丸、グラデーション可
- **フォント:** 読みやすいゴシック体、重要情報は太字
- **カード:** 白背景、影付き、角丸
- **FAB:** 右下固定、影付き、アニメーション

### レスポンシブ
- **スマホ:** 縦1カラム（ギャラリーは2カラム）、大きなタップ領域
- **タブレット:** ギャラリーは3カラム、サイドバー表示可能
- **PC:** 最大幅制限（800px程度）、中央寄せ、ギャラリーは4カラム

---

## 🚀 実装優先度

### **Phase 1（最優先・MVP Core）**
1. 新規登録 / ログイン（結婚式情報入力 + slug自動生成）
2. ギャラリー画面（アップロード + 一覧 + 個別DL）
3. ホーム画面（統計・共有URL/QRコード表示）

### **Phase 2（管理・課金機能）**
4. 設定画面（プラン変更・結婚式名変更）
5. 決済完了画面
6. 一括ダウンロード機能（ホーム画面）

### **Phase 3（補助機能）**
7. エラー画面（404、期限切れ）
8. 利用規約・プライバシーポリシー

---

## 📝 技術仕様・備考

### **一括ダウンロード**
- ホーム画面から実行
- ギャラリー画面のヘッダー（☁️）からもホーム画面へ遷移可能
- メール通知（SendGrid）
- ZIP有効期限: 7日間（R2から自動削除）

### **セキュリティ**
- CSRF対策（Clerk標準機能）
- Rate limiting（Workers）
- 一括DL・プラン変更APIは認証必須
- アップロードAPI: ファイルサイズ制限、MIME type検証
- Slug: ランダム生成で推測不可能、ブルートフォース対策

### **通知**
- 一括DL完了: メール通知
- 期限7日前: リマインダー送信（任意）
- 容量90%到達: 警告通知（任意）

### **アクセシビリティ**
- キーボード操作対応
- alt属性設定
- コントラスト比確保
- スクリーンリーダー対応

---

以上、WeddingSnap MVP の画面一覧です。
